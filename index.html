<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Loter√≠a Planner Lexin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #4f46e5, #111827);
      color: #f9fafb;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 92vh;
      border-radius: 24px;
      background: rgba(3, 7, 18, 0.96);
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      width: 220%;
      height: 220%;
      background: conic-gradient(
        from 180deg,
        #22c55e33,
        #3b82f633,
        #a855f733,
        #f9731633,
        #22c55e33
      );
      top: -60%;
      left: -60%;
      z-index: -1;
      animation: spin 18s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .app-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 8px;
    }

    .header h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }

    .header p {
      font-size: 0.85rem;
      opacity: 0.8;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0 14px 0;
      font-size: 0.9rem;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill span.icon {
      font-size: 1rem;
    }

    .main-card {
      flex: 1;
      background: #020617;
      border-radius: 20px;
      padding: 16px;
      border: 1px solid #111827;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 12px;
    }

    .type-label {
      align-self: flex-start;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 999px;
      background: #1d4ed8;
    }

    .question-text {
      font-size: 1rem;
      line-height: 1.4;
      margin-top: 6px;
    }

    .subtitle {
      font-size: 0.9rem;
      text-align: center;
      opacity: 0.85;
      margin-top: 4px;
    }

    .center-container {
      display: flex;
      justify-content: center;
      margin-top: 18px;
    }

    .lottery-btn {
      width: 190px;
      height: 190px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at 30% 10%, #fef3c7, #f97316);
      color: #111827;
      font-weight: 800;
      font-size: 1.3rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      box-shadow: 0 18px 32px rgba(248, 181, 0, 0.6);
      cursor: pointer;
      transition: transform 0.14s, box-shadow 0.14s, filter 0.2s;
      position: relative;
      overflow: hidden;
    }

    .lottery-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 0%, #ffffff77, transparent 55%);
      opacity: 0.8;
      mix-blend-mode: soft-light;
    }

    .lottery-btn:hover {
      transform: translateY(-3px) scale(1.02);
      filter: brightness(1.05);
      box-shadow: 0 24px 40px rgba(248, 181, 0, 0.7);
    }

    .lottery-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 10px 20px rgba(248, 181, 0, 0.5);
    }

    .options {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .option-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 14px;
      background: #020617;
      color: #f9fafb;
      text-align: left;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: transform 0.12s, background 0.12s, box-shadow 0.12s;
      border: 1px solid #111827;
    }

    .option-btn span.index {
      font-weight: 600;
      margin-right: 8px;
      opacity: 0.8;
    }

    .option-btn:hover {
      transform: translateY(-1px);
      background: #02091f;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.8);
    }

    .option-btn.correct {
      background: #15803d;
      border-color: #22c55e;
    }

    .option-btn.wrong {
      background: #b91c1c;
      border-color: #f97373;
    }

    .primary-btn,
    .secondary-btn {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .primary-btn {
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
    }

    .secondary-btn {
      background: transparent;
      border: 1px solid #4b5563;
      color: #e5e7eb;
    }

    .timer {
      font-weight: 600;
    }

    .hidden {
      display: none !important;
    }

    .result-text {
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      margin-top: 8px;
    }

    .feedback-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 6px;
      text-align: center;
    }

    .feedback-body {
      font-size: 0.9rem;
      opacity: 0.95;
      text-align: left;
    }

    .badge-win {
      background: linear-gradient(to right, #22c55e, #a3e635);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 800;
    }

    .badge-lose {
      color: #f97316;
      font-weight: 700;
    }

    .footer {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .app-win .main-card {
      background: radial-gradient(circle at top, #22c55e22, #022c22);
      border-color: #22c55e;
    }

    .app-lose .main-card {
      background: radial-gradient(circle at top, #f9731622, #111827);
      border-color: #f97316;
    }

    @media (max-width: 480px) {
      .app {
        border-radius: 0;
        min-height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="app" id="appRoot">
    <div class="app-inner">
      <header class="header">
        <h1>Loter√≠a Planner Lexin</h1>
        <p>Preguntas y retos b√°sicos para practicar Microsoft Planner en el equipo Lexin.</p>
      </header>

      <div class="status-bar">
        <div class="pill">
          <span class="icon">üéØ</span>
          <span id="progressText">0 / 3</span>
        </div>
        <div class="pill">
          <span class="icon">‚è±Ô∏è</span>
          <span class="timer" id="timerText">00s</span>
        </div>
      </div>

      <main class="main-card" id="mainCard">
        <!-- Pantalla inicial -->
        <div id="startScreen">
          <p class="subtitle">
            Toca el bot√≥n <strong>Loter√≠a</strong> y el sistema elegir√° al azar
            <strong>preguntas y retos sobre Planner</strong>.
            Cada ronda son 3 participaciones seguidas.
          </p>
          <div class="center-container">
            <button class="lottery-btn" id="startButton">
              Loter√≠a
            </button>
          </div>
        </div>

        <!-- Pantalla de juego -->
        <div id="gameScreen" class="hidden">
          <div id="itemArea">
            <div class="type-label" id="typeLabel">Pregunta</div>
            <div class="question-text" id="questionText"></div>

            <!-- Opciones para preguntas -->
            <div class="options" id="optionsContainer"></div>

            <!-- Bot√≥n ‚ÄúListo‚Äù para retos -->
            <div class="center-container" id="challengeActions">
              <button id="challengeDoneBtn" class="primary-btn hidden">Listo, lo hice</button>
            </div>
          </div>

          <!-- Pantalla de feedback (explicaci√≥n/respuesta) -->
          <div id="feedbackArea" class="hidden">
            <div class="feedback-title" id="feedbackTitle"></div>
            <p class="feedback-body" id="feedbackBody"></p>
            <div class="center-container" style="margin-top: 18px;">
              <button class="primary-btn" id="nextItemBtn" disabled>
                Siguiente (5)
              </button>
            </div>
          </div>
        </div>

        <!-- Pantalla final -->
        <div id="resultScreen" class="hidden">
          <div class="result-text" id="resultText"></div>
          <p class="subtitle" id="resultSubtitle"></p>
          <div class="center-container" style="margin-top: 16px; gap: 8px;">
            <button class="secondary-btn" id="backHomeBtn">Volver al inicio</button>
            <button class="primary-btn" id="retryBtn">Otro intento</button>
          </div>
        </div>
      </main>

      <footer class="footer">
        <span>Lexin ¬∑ Planner Power Mode</span>
        <span>Versi√≥n demo ampliable</span>
      </footer>
    </div>
  </div>

  <script>
    // ===============================
    // Banco de preguntas y retos
    // (puedes seguir agregando m√°s)
    // ===============================

    const questions = [
      {
        type: "question",
        text: "¬øQu√© es Microsoft Planner dentro de Office 365?",
        options: [
          "Un lector de correo electr√≥nico",
          "Una herramienta para gestionar tareas y tableros de trabajo",
          "Un programa para hacer videollamadas",
          "Un reemplazo completo de Excel"
        ],
        correctIndex: 1,
        explanation:
          "Microsoft Planner es una herramienta de planificaci√≥n visual para organizar tareas, proyectos y tableros de trabajo en equipo dentro de Office 365."
      },
      {
        type: "question",
        text: "¬øQu√© necesita una persona para poder usar Planner en la organizaci√≥n?",
        options: [
          "Tener una cuenta institucional/Office 365 activa",
          "Tener cuenta personal de Gmail",
          "Instalar una app de pago en el celular",
          "Tener permisos de administrador de TI"
        ],
        correctIndex: 0,
        explanation:
          "Para usar Planner se necesita una cuenta institucional/Office 365 que incluya la licencia de Planner y acceso al entorno de la organizaci√≥n."
      },
      {
        type: "question",
        text: "¬øC√≥mo se accede a Planner desde el navegador?",
        options: [
          "Entrando a YouTube y buscando Planner",
          "Entrando a office.com, iniciando sesi√≥n y seleccionando Planner en el lanzador de aplicaciones",
          "Descargando Planner desde una p√°gina no oficial",
          "No se puede usar en navegador, solo como app m√≥vil"
        ],
        correctIndex: 1,
        explanation:
          "La forma recomendada es entrar a office.com, iniciar sesi√≥n con la cuenta institucional, abrir el lanzador de aplicaciones (cuadricula) y seleccionar Planner."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© es un ‚Äúplan‚Äù?",
        options: [
          "Un chat entre dos personas",
          "Un tablero donde se agrupan tareas relacionadas a un objetivo o proyecto",
          "Un archivo de Word compartido",
          "Un grupo de correos electr√≥nicos"
        ],
        correctIndex: 1,
        explanation:
          "Un plan es un tablero de trabajo donde se agrupan tareas relacionadas a un objetivo o proyecto espec√≠fico."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© es un ‚Äúbucket‚Äù (cubeta)?",
        options: [
          "Un tipo de archivo especial",
          "Una etiqueta de prioridad",
          "Una columna que agrupa tareas por fases o temas",
          "Un chat general para el equipo"
        ],
        correctIndex: 2,
        explanation:
          "Un bucket es una columna dentro del plan que permite agrupar tareas por fases, temas o categor√≠as (por ejemplo: Pendiente, En proceso, Finalizado)."
      },
      {
        type: "question",
        text: "¬øCu√°l es una ventaja de usar Planner para el equipo Lexin?",
        options: [
          "Cada persona trabaja aislada y sin ver las tareas de los dem√°s",
          "Permite visualizar el trabajo del equipo, asignar responsables y fechas l√≠mite",
          "Solo sirve para registrar problemas t√©cnicos",
          "Reemplaza todas las reuniones del equipo"
        ],
        correctIndex: 1,
        explanation:
          "Planner ayuda a Lexin a visualizar el trabajo del equipo, asignar responsables, fechas l√≠mite y hacer seguimiento de forma clara."
      },
      {
        type: "question",
        text: "¬øQu√© elemento se usa en Planner para ver qui√©n es responsable de una tarea?",
        options: [
          "El color del bucket",
          "El adjunto de la tarea",
          "El campo de ‚Äúmiembros/asignados‚Äù",
          "El t√≠tulo del plan"
        ],
        correctIndex: 2,
        explanation:
          "En Planner se asignan tareas a uno o varios miembros del plan desde el campo de ‚Äúasignados‚Äù o ‚Äúmiembros responsables‚Äù."
      },
      {
        type: "question",
        text: "Si una tarea ya fue terminada, ¬øqu√© deber√≠amos hacer en Planner?",
        options: [
          "Eliminarla para que no se vea",
          "Marcarla como completada para que quede el registro",
          "Cambiarle el t√≠tulo por la palabra LISTO",
          "Moverla al primer bucket aunque no est√© terminada"
        ],
        correctIndex: 1,
        explanation:
          "Lo ideal es marcar la tarea como completada, para que quede el registro hist√≥rico de que se realiz√≥."
      },
      {
        type: "question",
        text: "¬øPor qu√© es importante escribir buenas descripciones en las tareas de Planner?",
        options: [
          "Para que la tarjeta sea m√°s grande",
          "Para que solo el creador entienda la tarea",
          "Para que cualquier miembro del equipo entienda claramente qu√© hay que hacer",
          "No es importante, la descripci√≥n es opcional"
        ],
        correctIndex: 2,
        explanation:
          "Una buena descripci√≥n ayuda a que cualquier persona del equipo entienda el alcance, pasos y detalles de la tarea."
      },
      {
        type: "question",
        text: "Si Lexin quiere usar Planner para sus proyectos, ¬øqu√© beneficio obtiene?",
        options: [
          "Menos visibilidad del trabajo",
          "Mejor organizaci√≥n, seguimiento y claridad de qui√©n hace qu√© y para cu√°ndo",
          "M√°s correos y m√°s confusi√≥n",
          "Solo sirve para guardar archivos"
        ],
        correctIndex: 1,
        explanation:
          "Planner permite a Lexin organizar proyectos, ver responsables, fechas, avances y as√≠ reducir la confusi√≥n en el trabajo diario."
      },
      {
        type: "question",
        text: "¬øQu√© tipo de informaci√≥n es recomendable colocar en el t√≠tulo de una tarea?",
        options: [
          "Un chiste interno del equipo",
          "Un texto corto y claro que resuma la acci√≥n principal",
          "La fecha de nacimiento del responsable",
          "Solo un n√∫mero sin contexto"
        ],
        correctIndex: 1,
        explanation:
          "El t√≠tulo debe ser corto y claro, resumiendo la acci√≥n principal, por ejemplo: ‚ÄúDise√±ar plantilla de reporte de Lexin en Planner‚Äù."
      },
      {
        type: "question",
        text: "¬øQu√© representa la vista de ‚ÄúGr√°ficos‚Äù (Charts) en Planner?",
        options: [
          "Un chat del equipo",
          "Estad√≠sticas del plan: tareas completadas, en curso, retrasadas, etc.",
          "Una lista de correos enviados",
          "Un calendario externo"
        ],
        correctIndex: 1,
        explanation:
          "La vista de gr√°ficos muestra estad√≠sticas y visualizaciones de las tareas por estado, miembro, prioridad, etc."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© permite la fecha de vencimiento de una tarea?",
        options: [
          "Enviar la tarea a otra organizaci√≥n",
          "Definir hasta cu√°ndo deber√≠a estar terminada y mejorar el seguimiento",
          "Bloquear la tarea autom√°ticamente",
          "Borrar la tarea al llegar la fecha"
        ],
        correctIndex: 1,
        explanation:
          "La fecha de vencimiento ayuda a fijar un l√≠mite de tiempo para completar la tarea y mejorar el seguimiento del plan."
      },
      {
        type: "question",
        text: "¬øC√≥mo se relaciona Planner con Teams?",
        options: [
          "No se pueden usar juntos",
          "Se puede agregar un plan de Planner como pesta√±a dentro de un canal de Teams",
          "Teams borra los planes de Planner",
          "Solo sirve para chats privados"
        ],
        correctIndex: 1,
        explanation:
          "Planner se integra con Teams, permitiendo agregar un plan como pesta√±a dentro de un canal para que el equipo lo use directamente."
      },
      {
        type: "question",
        text: "Si una tarea de Lexin est√° muy confusa, ¬øqu√© acci√≥n es recomendable?",
        options: [
          "Ignorarla hasta que desaparezca",
          "Borrarla sin avisar",
          "Mejorar el t√≠tulo y la descripci√≥n, y comentar en la tarea para aclarar dudas",
          "Crear otra tarea duplicada"
        ],
        correctIndex: 2,
        explanation:
          "Es mejor aclarar la tarea: mejorar t√≠tulo/descripci√≥n y usar los comentarios para que el equipo comparta dudas y acuerdos."
      },
      {
        type: "question",
        text: "¬øPor qu√© Lexin quiere implementar Planner?",
        options: [
          "Porque est√° de moda tener muchas apps",
          "Para tener un espacio visual donde organizar tareas, proyectos y responsabilidades del equipo",
          "Para reemplazar todos los documentos",
          "Para no volver a reunirse nunca m√°s"
        ],
        correctIndex: 1,
        explanation:
          "Lexin busca en Planner un espacio visual y compartido para organizar tareas y proyectos, asignar responsables y hacer seguimiento."
      }
    ];

    const challenges = [
      {
        type: "challenge",
        text:
          "Reto: Explica en voz alta, en menos de 30 segundos, qu√© es Planner y para qu√© lo est√° usando Lexin.",
        guide:
          "Respuesta sugerida: Planner es una herramienta de Office 365 para organizar tareas y proyectos. Lexin la usa para visualizar el trabajo del equipo, asignar responsables y hacer seguimiento de sus actividades."
      },
      {
        type: "challenge",
        text:
          "Reto: Desde tu computador, entra a office.com e indica paso a paso c√≥mo encontrar la aplicaci√≥n Planner.",
        guide:
          "Gu√≠a sugerida: 1) Abre office.com. 2) Inicia sesi√≥n con tu cuenta institucional. 3) Haz clic en el lanzador de aplicaciones (cuadrito de puntos). 4) Busca y selecciona 'Planner'."
      },
      {
        type: "challenge",
        text:
          "Reto: Piensa en un proyecto real del equipo Lexin y di en voz alta c√≥mo lo organizar√≠as en buckets dentro de Planner.",
        guide:
          "Ejemplo: Para un proyecto, podr√≠as crear buckets como 'Ideas', 'En planeaci√≥n', 'En ejecuci√≥n' y 'Finalizado'. As√≠ se ve el avance de Lexin de forma clara."
      },
      {
        type: "challenge",
        text:
          "Reto: Imagina una tarea que hoy haces por correo. Di en voz alta c√≥mo la convertir√≠as en una tarea de Planner (t√≠tulo, descripci√≥n y responsable).",
        guide:
          "Ejemplo: T√≠tulo: 'Enviar reporte semanal de Lexin'. Descripci√≥n: Detallar contenido del reporte y fecha. Responsable: asignar a la persona encargada."
      },
      {
        type: "challenge",
        text:
          "Reto: Menciona al menos tres datos que puedes configurar dentro de una tarea de Planner.",
        guide:
          "Respuesta sugerida: En una tarea de Planner puedes configurar: t√≠tulo, descripci√≥n, fecha de vencimiento, asignados, checklist, etiquetas, adjuntos y comentarios."
      },
      {
        type: "challenge",
        text:
          "Reto: Di en voz alta por qu√© usar Planner puede reducir la cantidad de correos internos en el equipo Lexin.",
        guide:
          "Explicaci√≥n: Planner centraliza las tareas y comentarios en un mismo lugar, en lugar de dispersar la informaci√≥n en muchos correos."
      },
      {
        type: "challenge",
        text:
          "Reto: Piensa una tarea que actualmente no est√° clara en el equipo Lexin y describe c√≥mo la reescribir√≠as en Planner para que cualquiera la entienda.",
        guide:
          "Gu√≠a: Usa un t√≠tulo claro orientado a la acci√≥n y una descripci√≥n que explique qu√© se espera, para cu√°ndo y con qu√© criterios de √©xito."
      },
      {
        type: "challenge",
        text:
          "Reto: Imagina que debes ense√±ar Planner a un nuevo miembro de Lexin. Resume en 30 segundos c√≥mo le explicar√≠as el plan principal del equipo.",
        guide:
          "Ejemplo: 'Este es nuestro plan en Planner: aqu√≠ vemos los buckets con las fases del trabajo, las tareas con sus responsables y fechas, y usamos colores para los tipos de actividad.'"
      },
      {
        type: "challenge",
        text:
          "Reto: Menciona en voz alta dos beneficios que esperas lograr en Lexin usando Planner durante los pr√≥ximos meses.",
        guide:
          "Beneficios posibles: mayor claridad sobre qui√©n hace qu√©, menos confusi√≥n por tareas duplicadas, mejor seguimiento de fechas y avances."
      },
      {
        type: "challenge",
        text:
          "Reto: Describe c√≥mo podr√≠as usar las etiquetas de colores en Planner para organizar las tareas de Lexin.",
        guide:
          "Ejemplo: usar etiquetas por tipo de tarea (formaci√≥n, soporte, reuniones), o por prioridad (alta, media, baja), o por proyecto."
      }
    ];

    // ===============================
    // Estado del juego
    // ===============================
    const maxPerRound = 3;
    let currentItem = null;
    let currentType = null; // 'question' o 'challenge'
    let roundCount = 0;
    let successCount = 0;
    let timerId = null;
    let timeLeft = 0;
    let pendingWasSuccess = false;
    let feedbackTimerId = null;
    let feedbackSeconds = 5;
    let lastResultSource = "question"; // para tipo de mensaje

    // ===============================
    // Elementos del DOM
    // ===============================
    const appRoot = document.getElementById("appRoot");
    const startScreen = document.getElementById("startScreen");
    const gameScreen = document.getElementById("gameScreen");
    const resultScreen = document.getElementById("resultScreen");

    const itemArea = document.getElementById("itemArea");
    const feedbackArea = document.getElementById("feedbackArea");

    const startButton = document.getElementById("startButton");
    const progressText = document.getElementById("progressText");
    const timerText = document.getElementById("timerText");
    const typeLabel = document.getElementById("typeLabel");
    const questionText = document.getElementById("questionText");
    const optionsContainer = document.getElementById("optionsContainer");
    const challengeActions = document.getElementById("challengeActions");
    const challengeDoneBtn = document.getElementById("challengeDoneBtn");

    const feedbackTitle = document.getElementById("feedbackTitle");
    const feedbackBody = document.getElementById("feedbackBody");
    const nextItemBtn = document.getElementById("nextItemBtn");

    const resultText = document.getElementById("resultText");
    const resultSubtitle = document.getElementById("resultSubtitle");
    const retryBtn = document.getElementById("retryBtn");
    const backHomeBtn = document.getElementById("backHomeBtn");

    // ===============================
    // Funciones de navegaci√≥n
    // ===============================
    function showStartScreen() {
      stopTimer();
      stopFeedbackTimer();
      roundCount = 0;
      successCount = 0;
      updateProgress();
      timerText.textContent = "00s";

      appRoot.classList.remove("app-win", "app-lose");

      startScreen.classList.remove("hidden");
      gameScreen.classList.add("hidden");
      resultScreen.classList.add("hidden");
    }

    function showGameScreen() {
      startScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      resultScreen.classList.add("hidden");
      itemArea.classList.remove("hidden");
      feedbackArea.classList.add("hidden");
    }

    function showResultScreen(won) {
      stopTimer();
      stopFeedbackTimer();
      startScreen.classList.add("hidden");
      gameScreen.classList.add("hidden");
      resultScreen.classList.remove("hidden");

      if (won) {
        appRoot.classList.add("app-win");
        appRoot.classList.remove("app-lose");
        resultText.innerHTML = "üéâ ¬°Ganaste! <span class='badge-win'>Eres un pro en Planner</span> üéâ";
        resultSubtitle.textContent =
          "Completaste 3 participaciones exitosas. Sigue usando Planner con Lexin para mantener este nivel.";
      } else {
        appRoot.classList.add("app-lose");
        appRoot.classList.remove("app-win");
        resultText.innerHTML = "‚ú® Est√°s casi a ser un pro en Planner ‚ú®";
        resultSubtitle.textContent =
          "Sigue practicando en Planner con el equipo Lexin. Cada intento te ayuda a entender mejor la herramienta.";
      }
    }

    function updateProgress() {
      progressText.textContent = `${roundCount} / ${maxPerRound}`;
    }

    // ===============================
    // L√≥gica del juego
    // ===============================
    function randomFromArray(arr) {
      const i = Math.floor(Math.random() * arr.length);
      return arr[i];
    }

    function pickRandomItem() {
      // 50% preguntas, 50% retos (siempre y cuando existan ambos)
      const chooseQuestion = Math.random() < 0.5;
      if (chooseQuestion && questions.length > 0) {
        return questions[Math.floor(Math.random() * questions.length)];
      } else if (!chooseQuestion && challenges.length > 0) {
        return challenges[Math.floor(Math.random() * challenges.length)];
      } else if (questions.length > 0) {
        return randomFromArray(questions);
      } else {
        return randomFromArray(challenges);
      }
    }

    function startGame() {
      roundCount = 0;
      successCount = 0;
      updateProgress();
      appRoot.classList.remove("app-win", "app-lose");
      loadNewItem();
    }

    function loadNewItem() {
      stopTimer();
      stopFeedbackTimer();
      currentItem = pickRandomItem();
      currentType = currentItem.type;
      pendingWasSuccess = false;
      lastResultSource = currentType;

      renderCurrentItem();
    }

    function renderCurrentItem() {
      showGameScreen();
      clearOptions();
      itemArea.classList.remove("hidden");
      feedbackArea.classList.add("hidden");

      if (!currentItem) return;

      if (currentType === "question") {
        typeLabel.textContent = "Pregunta";
        questionText.textContent = currentItem.text;
        optionsContainer.classList.remove("hidden");
        challengeDoneBtn.classList.add("hidden");

        currentItem.options.forEach(function (opt, index) {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.innerHTML =
            "<span><span class='index'>" +
            String.fromCharCode(65 + index) +
            ".</span> " +
            opt +
            "</span>";
          btn.addEventListener("click", function () {
            handleAnswer(index, btn);
          });
          optionsContainer.appendChild(btn);
        });

        startTimer(20, function () {
          // Se acab√≥ el tiempo para la pregunta
          pendingWasSuccess = false;
          showFeedback(false, true); // false = fallo, true = por tiempo
        });
      } else if (currentType === "challenge") {
        typeLabel.textContent = "Reto";
        questionText.textContent = currentItem.text;

        optionsContainer.classList.add("hidden");
        challengeDoneBtn.classList.remove("hidden");

        challengeDoneBtn.onclick = function () {
          // El participante indica que lo realiz√≥
          pendingWasSuccess = true;
          showFeedback(true, false);
        };

        startTimer(30, function () {
          // Se acab√≥ el tiempo para el reto
          pendingWasSuccess = false;
          showFeedback(false, true);
        });
      }
    }

    function clearOptions() {
      optionsContainer.innerHTML = "";
    }

    function handleAnswer(selectedIndex) {
      if (!currentItem || currentType !== "question") return;

      const correctIndex = currentItem.correctIndex;
      const optionButtons = Array.prototype.slice.call(
        optionsContainer.querySelectorAll(".option-btn")
      );

      optionButtons.forEach(function (btn, i) {
        if (i === correctIndex) btn.classList.add("correct");
        if (i === selectedIndex && selectedIndex !== correctIndex) {
          btn.classList.add("wrong");
        }
        btn.disabled = true;
      });

      stopTimer();

      if (selectedIndex === correctIndex) {
        pendingWasSuccess = true;
        showFeedback(true, false);
      } else {
        pendingWasSuccess = false;
        showFeedback(false, false);
      }
    }

    function showFeedback(isSuccess, byTimeout) {
      stopTimer();
      itemArea.classList.add("hidden");
      feedbackArea.classList.remove("hidden");

      let title = "";
      let body = "";

      if (currentType === "question") {
        const correctText = currentItem.options[currentItem.correctIndex];
        if (isSuccess) {
          title = "‚úÖ ¬°Respuesta correcta!";
          body =
            "La respuesta correcta es: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        } else if (byTimeout) {
          title = "‚è±Ô∏è Tiempo agotado";
          body =
            "Se acab√≥ el tiempo. La respuesta correcta era: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        } else {
          title = "‚ùå Respuesta incorrecta";
          body =
            "La respuesta correcta es: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        }
      } else if (currentType === "challenge") {
        if (isSuccess) {
          title = "üí™ ¬°Reto completado!";
          body =
            (currentItem.guide
              ? "Esta es una forma sugerida de hacerlo: "
              : "") +
            (currentItem.guide || "");
        } else if (byTimeout) {
          title = "‚è±Ô∏è Reto no completado a tiempo";
          body =
            "No pasa nada, aqu√≠ tienes una gu√≠a para hacerlo la pr√≥xima vez: " +
            (currentItem.guide || "");
        } else {
          title = "Reto no completado";
          body =
            "Aqu√≠ tienes una gu√≠a para la pr√≥xima vez: " +
            (currentItem.guide || "");
        }
      }

      feedbackTitle.innerHTML = title;
      feedbackBody.innerHTML = body;

      nextItemBtn.disabled = true;
      feedbackSeconds = 5;
      nextItemBtn.textContent = "Siguiente (" + feedbackSeconds + ")";
      startFeedbackTimer();
    }

    function applyFeedbackAndContinue() {
      // Se ejecuta cuando el usuario pulsa ‚ÄúSiguiente‚Äù
      roundCount++;
      if (pendingWasSuccess) {
        successCount++;
      }
      updateProgress();

      if (roundCount >= maxPerRound) {
        const won = successCount >= maxPerRound;
        showResultScreen(won);
      } else {
        loadNewItem();
      }
    }

    // ===============================
    // Timer principal
    // ===============================
    function startTimer(seconds, onTimeOut) {
      stopTimer();
      timeLeft = seconds;
      timerText.textContent = timeLeft + "s";

      timerId = setInterval(function () {
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        timerText.textContent = timeLeft + "s";

        if (timeLeft <= 0) {
          stopTimer();
          if (typeof onTimeOut === "function") {
            onTimeOut();
          }
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    // ===============================
    // Timer de feedback (5 segundos)
    // ===============================
    function startFeedbackTimer() {
      stopFeedbackTimer();
      feedbackTimerId = setInterval(function () {
        feedbackSeconds--;
        if (feedbackSeconds <= 0) {
          feedbackSeconds = 0;
          stopFeedbackTimer();
          nextItemBtn.disabled = false;
          nextItemBtn.textContent = "Siguiente";
        } else {
          nextItemBtn.textContent = "Siguiente (" + feedbackSeconds + ")";
        }
      }, 1000);
    }

    function stopFeedbackTimer() {
      if (feedbackTimerId) {
        clearInterval(feedbackTimerId);
        feedbackTimerId = null;
      }
    }

    // ===============================
    // Eventos
    // ===============================
    startButton.addEventListener("click", function () {
      startGame();
    });

    retryBtn.addEventListener("click", function () {
      startGame();
    });

    backHomeBtn.addEventListener("click", function () {
      showStartScreen();
    });

    nextItemBtn.addEventListener("click", function () {
      if (!nextItemBtn.disabled) {
        applyFeedbackAndContinue();
      }
    });

    // Pantalla inicial por defecto
    showStartScreen();
  </script>
</body>
</html>
