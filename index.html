<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Loter√≠a Planner Lexin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #4f46e5, #111827);
      color: #f9fafb;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Tema claro */
    body.light-theme {
      background: radial-gradient(circle at top, #e5e7eb, #c7d2fe);
      color: #0f172a;
    }
    body.light-theme .app {
      background: rgba(249, 250, 251, 0.98);
      color: #0f172a;
    }
    body.light-theme .main-card {
      background: #f9fafb;
      border-color: #e5e7eb;
    }
    body.light-theme .lifeline-bar {
      background: #e5e7eb;
      border-color: #d1d5db;
    }
    body.light-theme .lifeline-btn {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
    }
    body.light-theme .lifeline-btn:hover:not(:disabled) {
      background: #e5e7eb;
    }
    body.light-theme .top-bar {
      background: linear-gradient(to right, #3b82f6, #a855f7);
      color: #f9fafb;
    }
    body.light-theme .bottom-footer {
      color: #111827;
    }
    body.light-theme .option-btn {
      background: #f9fafb;
      color: #111827;
      border-color: #e5e7eb;
    }
    body.light-theme .option-btn:hover {
      background: #e5e7eb;
    }

    .app {
      width: 100%;
      max-width: 520px;
      min-height: 95vh;
      border-radius: 24px;
      background: rgba(3, 7, 18, 0.96);
      padding: 0;
      display: flex;
      flex-direction: column;
      box-shadow: 0 24px 50px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      width: 220%;
      height: 220%;
      background: conic-gradient(
        from 180deg,
        #22c55e33,
        #3b82f633,
        #a855f733,
        #f9731633,
        #22c55e33
      );
      top: -60%;
      left: -60%;
      z-index: -1;
      animation: spin 22s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .app-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* Barra superior */
    .top-bar {
      background: linear-gradient(to right, #facc15, #f97316);
      color: #111827;
      padding: 10px 16px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }

    .top-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .top-title {
      font-weight: 900;
      font-size: 1rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .top-subtitle {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .top-badges {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }

    .circle-icon {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #fefce8;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .status-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.15);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .status-pill span.icon {
      font-size: 0.95rem;
    }

    .timer {
      font-weight: 800;
    }

    .timer-warning {
      color: #fecaca;
      animation: pulse 0.8s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .theme-toggle-btn {
      border-radius: 999px;
      border: none;
      padding: 4px 8px;
      font-size: 0.75rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(0,0,0,0.15);
      color: inherit;
    }

    .content-area {
      flex: 1;
      padding: 10px 14px 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .main-card {
      flex: 1;
      background: #020617;
      border-radius: 22px;
      padding: 16px;
      border: 1px solid #111827;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }

    .category-label {
      align-self: flex-start;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 4px 10px;
      border-radius: 999px;
      background: #1d4ed8;
    }

    .question-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
    }

    .question-number {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .streak-pill {
      font-size: 0.9rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: #022c22;
      color: #bbf7d0;
    }

    .question-text {
      font-size: 1.15rem;
      line-height: 1.5;
      margin-top: 8px;
    }

    .subtitle {
      font-size: 1rem;
      text-align: center;
      opacity: 0.9;
      margin-top: 8px;
    }

    .center-container {
      display: flex;
      justify-content: center;
      margin-top: 16px;
    }

    .lottery-btn {
      width: 210px;
      height: 210px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at 30% 10%, #fef3c7, #f97316);
      color: #111827;
      font-weight: 900;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      box-shadow: 0 22px 40px rgba(248, 181, 0, 0.7);
      cursor: pointer;
      transition: transform 0.14s, box-shadow 0.14s, filter 0.2s;
      position: relative;
      overflow: hidden;
    }

    .lottery-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 0%, #ffffff88, transparent 55%);
      opacity: 0.9;
      mix-blend-mode: soft-light;
    }

    .lottery-btn:hover {
      transform: translateY(-4px) scale(1.02);
      filter: brightness(1.05);
      box-shadow: 0 26px 48px rgba(248, 181, 0, 0.9);
    }

    .lottery-btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 12px 24px rgba(248, 181, 0, 0.6);
    }

    .options {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option-btn {
      border: none;
      border-radius: 999px;
      padding: 12px 16px;
      background: #020617;
      color: #f9fafb;
      text-align: left;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: transform 0.12s, background 0.12s, box-shadow 0.12s, border-color 0.12s;
      border: 1px solid #111827;
    }

    .option-btn span.index {
      font-weight: 700;
      margin-right: 8px;
      opacity: 0.85;
      font-size: 1.05rem;
    }

    .option-btn:hover {
      transform: translateY(-1px);
      background: #02091f;
      box-shadow: 0 4px 11px rgba(15, 23, 42, 0.9);
    }

    .option-btn.correct {
      background: #16a34a;
      border-color: #22c55e;
      color: #ecfdf3;
      box-shadow: 0 4px 14px rgba(22, 163, 74, 0.8);
    }

    .option-btn.wrong {
      background: #b91c1c;
      border-color: #fecaca;
      color: #fee2e2;
      box-shadow: 0 4px 14px rgba(185, 28, 28, 0.8);
    }

    .option-btn.eliminated {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .primary-btn,
    .secondary-btn {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 0.95rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .primary-btn {
      background: #22c55e;
      color: #022c22;
      font-weight: 700;
    }

    .secondary-btn {
      background: transparent;
      border: 1px solid #4b5563;
      color: #e5e7eb;
    }

    .primary-btn:disabled,
    .secondary-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .feedback-title {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
    }

    .feedback-body {
      font-size: 1rem;
      opacity: 0.95;
      text-align: left;
    }

    .result-text {
      font-size: 1.6rem;
      font-weight: 900;
      text-align: center;
      margin-top: 8px;
    }

    .win-bounce {
      display: inline-block;
      animation: bounce-colors 2.2s infinite;
    }

    @keyframes bounce-colors {
      0%   { transform: translateX(-10%) translateY(0) scale(1); color: #22c55e; }
      25%  { transform: translateX(10%) translateY(-10px) scale(1.1); color: #facc15; }
      50%  { transform: translateX(-5%) translateY(0) scale(1); color: #38bdf8; }
      75%  { transform: translateX(5%) translateY(-12px) scale(1.12); color: #f97316; }
      100% { transform: translateX(0) translateY(0) scale(1); color: #22c55e; }
    }

    .subtitle-small {
      font-size: 0.95rem;
      text-align: center;
      opacity: 0.9;
      margin-top: 8px;
    }

    .lifeline-bar {
      margin-top: 6px;
      padding: 8px 10px;
      background: #020617;
      border-radius: 999px;
      border: 1px solid #111827;
      display: flex;
      align-items: center;
      justify-content: space-around;
      gap: 6px;
      font-size: 0.85rem;
    }

    .lifeline-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 8px 8px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #0b1120;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      border: 1px solid #111827;
      transition: background 0.12s, transform 0.12s, box-shadow 0.12s;
    }

    .lifeline-btn span.icon {
      font-size: 1.1rem;
    }

    .lifeline-btn:hover:not(:disabled) {
      background: #020617;
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(15,23,42,0.8);
    }

    .lifeline-btn:disabled {
      opacity: 0.3;
      cursor: default;
    }

    .bottom-footer {
      padding: 6px 16px 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.9rem;
      color: #e5e7eb;
      font-style: italic;
      font-weight: 600;
    }

    .app-win .main-card {
      background: radial-gradient(circle at top, #22c55e22, #022c22);
      border-color: #22c55e;
    }

    .app-lose .main-card {
      background: radial-gradient(circle at top, #f9731622, #111827);
      border-color: #f97316;
    }

    .hidden {
      display: none !important;
    }

    /* Overlay de cuenta regresiva grande */
    #countdownOverlay {
      position: absolute;
      left: 50%;
      bottom: 20%;
      transform: translateX(-50%);
      font-size: 4rem;
      font-weight: 900;
      color: #ef4444;
      text-shadow: 0 0 20px rgba(0,0,0,0.8);
      opacity: 0;
      pointer-events: none;
    }

    #countdownOverlay.show {
      animation: countdown-pop 0.6s forwards;
    }

    @keyframes countdown-pop {
      0%   { opacity: 0; transform: translateX(-50%) translateY(20px) scale(0.9); }
      20%  { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.1); }
      80%  { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-10px) scale(0.9); }
    }

    @media (max-width: 480px) {
      .app {
        border-radius: 0;
        min-height: 100vh;
      }
      #countdownOverlay {
        font-size: 3.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="app" id="appRoot">
    <div class="app-inner">
      <!-- Overlay cuenta regresiva grande -->
      <div id="countdownOverlay"></div>

      <!-- Barra superior -->
      <div class="top-bar">
        <div class="top-left">
          <div class="top-title">PLANNER ¬∑ LEXIN</div>
          <div class="top-subtitle">Trivias y retos para empezar a usar Planner en equipo.</div>
        </div>
        <div class="top-right">
          <button class="theme-toggle-btn" id="themeToggleBtn">
            <span id="themeIcon">üåô</span>
            <span id="themeLabel">Oscuro</span>
          </button>
          <div class="top-badges">
            <div class="circle-icon">üé≤</div>
            <div class="status-pill">
              <span class="icon">‚úÖ</span>
              <span id="progressText">0 / 3</span>
            </div>
            <div class="status-pill">
              <span class="icon">‚è±Ô∏è</span>
              <span class="timer" id="timerText">00s</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Contenido central -->
      <div class="content-area">
        <div class="main-card" id="mainCard">
          <!-- Pantalla de inicio -->
          <div id="startScreen">
            <p class="subtitle">
              Toca el bot√≥n <strong>Loter√≠a</strong> para iniciar una ronda de
              <strong>3 participaciones</strong> con preguntas y retos sobre Planner.
              Usa los comodines como en Preguntados.
            </p>
            <div class="center-container">
              <button class="lottery-btn" id="startButton">
                Loter√≠a
              </button>
            </div>
          </div>

          <!-- Pantalla de juego -->
          <div id="gameScreen" class="hidden">
            <div id="itemArea">
              <div class="category-label" id="typeLabel">Pregunta</div>

              <div class="question-header">
                <div class="question-number" id="questionNumberText">
                  Pregunta / Reto
                </div>
                <div class="streak-pill" id="streakText">
                  Racha: 0 ‚úÖ
                </div>
              </div>

              <div class="question-text" id="questionText"></div>

              <!-- Opciones para preguntas -->
              <div class="options" id="optionsContainer"></div>

              <!-- Acciones para retos -->
              <div class="center-container" id="challengeActions">
                <button id="challengeDoneBtn" class="primary-btn hidden">
                  Listo, lo hice
                </button>
              </div>
            </div>

            <!-- Feedback / explicaci√≥n -->
            <div id="feedbackArea" class="hidden">
              <div class="feedback-title" id="feedbackTitle"></div>
              <p class="feedback-body" id="feedbackBody"></p>
              <div class="center-container" style="margin-top: 16px;">
                <button class="primary-btn" id="nextItemBtn" disabled>
                  Siguiente (5)
                </button>
              </div>
            </div>
          </div>

          <!-- Pantalla final -->
          <div id="resultScreen" class="hidden">
            <div class="result-text" id="resultText"></div>
            <p class="subtitle-small" id="resultSubtitle"></p>
            <div class="center-container" style="margin-top: 18px; gap: 8px;">
              <button class="secondary-btn" id="backHomeBtn">Volver al inicio</button>
              <button class="primary-btn" id="retryBtn">Otro intento</button>
            </div>
          </div>
        </div>

        <!-- Barra de comodines -->
        <div class="lifeline-bar" id="lifelineBar">
          <button class="lifeline-btn" id="skipBtn">
            <span class="icon">üîÅ</span>
            <span>Cambiar</span>
          </button>
          <button class="lifeline-btn" id="phoneBtn">
            <span class="icon">üìû</span>
            <span>Llamar a un amigo</span>
          </button>
          <button class="lifeline-btn" id="fiftyBtn">
            <span class="icon">‚ûñ‚ûñ</span>
            <span>50/50</span>
          </button>
        </div>
      </div>

      <!-- Pie de p√°gina -->
      <div class="bottom-footer">
        Lexin ¬∑ Planner Power Mode
      </div>
    </div>
  </div>

  <script>
    // ===============================
    // AUDIO simple (beeps)
    // ===============================
    let audioCtx = null;
    function getAudioCtx() {
      if (!audioCtx) {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (AudioContext) audioCtx = new AudioContext();
      }
      return audioCtx;
    }

    function playBeep(freq = 880, duration = 120, volume = 0.25) {
      const ctx = getAudioCtx();
      if (!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.value = volume;
      const now = ctx.currentTime;
      osc.start(now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration / 1000);
      osc.stop(now + duration / 1000);
    }

    function playWinSound() {
      setTimeout(() => playBeep(880, 140, 0.3), 0);
      setTimeout(() => playBeep(1200, 160, 0.25), 160);
      setTimeout(() => playBeep(1500, 200, 0.2), 340);
    }

    function playLoseSound() {
      setTimeout(() => playBeep(440, 200, 0.3), 0);
      setTimeout(() => playBeep(330, 220, 0.25), 220);
    }

    // ===============================
    // Banco de preguntas y retos (ejemplos)
    // Para llegar a 100 preguntas y 50 retos:
    // copia y pega m√°s objetos siguiendo este mismo formato.
    // ===============================
    const questions = [
      {
        type: "question",
        text: "¬øQu√© es Microsoft Planner dentro de Office 365?",
        options: [
          "Un lector de correo electr√≥nico",
          "Una herramienta para gestionar tareas y tableros de trabajo",
          "Un programa para hacer videollamadas",
          "Un reemplazo completo de Excel"
        ],
        correctIndex: 1,
        explanation:
          "Microsoft Planner es una herramienta de planificaci√≥n visual para organizar tareas, proyectos y tableros de trabajo en equipo dentro de Office 365."
      },
      {
        type: "question",
        text: "¬øQu√© necesita una persona para poder usar Planner en la organizaci√≥n?",
        options: [
          "Tener una cuenta institucional/Office 365 activa",
          "Tener cuenta personal de Gmail",
          "Instalar una app de pago en el celular",
          "Tener permisos de administrador de TI"
        ],
        correctIndex: 0,
        explanation:
          "Para usar Planner se necesita una cuenta institucional/Office 365 con licencia activa y acceso al entorno de la organizaci√≥n."
      },
      {
        type: "question",
        text: "¬øC√≥mo se accede a Planner desde el navegador?",
        options: [
          "Entrando a YouTube y buscando Planner",
          "Entrando a office.com, iniciando sesi√≥n y seleccionando Planner en el lanzador de aplicaciones",
          "Descargando Planner desde una p√°gina no oficial",
          "No se puede usar en navegador, solo como app m√≥vil"
        ],
        correctIndex: 1,
        explanation:
          "La forma recomendada es entrar a office.com, iniciar sesi√≥n con la cuenta institucional, abrir el lanzador de aplicaciones y seleccionar Planner."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© es un ‚Äúplan‚Äù?",
        options: [
          "Un chat entre dos personas",
          "Un tablero donde se agrupan tareas relacionadas a un objetivo o proyecto",
          "Un archivo de Word compartido",
          "Un grupo de correos electr√≥nicos"
        ],
        correctIndex: 1,
        explanation:
          "Un plan es un tablero de trabajo donde se agrupan tareas relacionadas a un objetivo o proyecto espec√≠fico."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© es un ‚Äúbucket‚Äù (cubeta)?",
        options: [
          "Un tipo de archivo especial",
          "Una etiqueta de prioridad",
          "Una columna que agrupa tareas por fases o temas",
          "Un chat general para el equipo"
        ],
        correctIndex: 2,
        explanation:
          "Un bucket es una columna dentro del plan que permite agrupar tareas por fases, temas o categor√≠as (por ejemplo: Pendiente, En proceso, Finalizado)."
      },
      {
        type: "question",
        text: "¬øCu√°l es una ventaja de usar Planner para el equipo Lexin?",
        options: [
          "Cada persona trabaja aislada y sin ver las tareas de los dem√°s",
          "Permite visualizar el trabajo del equipo, asignar responsables y fechas l√≠mite",
          "Solo sirve para registrar problemas t√©cnicos",
          "Reemplaza todas las reuniones del equipo"
        ],
        correctIndex: 1,
        explanation:
          "Planner ayuda a Lexin a visualizar el trabajo del equipo, asignar responsables, fechas l√≠mite y hacer seguimiento de forma clara."
      },
      {
        type: "question",
        text: "¬øQu√© elemento se usa en Planner para ver qui√©n es responsable de una tarea?",
        options: [
          "El color del bucket",
          "El adjunto de la tarea",
          "El campo de ‚Äúmiembros/asignados‚Äù",
          "El t√≠tulo del plan"
        ],
        correctIndex: 2,
        explanation:
          "En Planner se asignan tareas a uno o varios miembros del plan desde el campo de ‚Äúasignados‚Äù o ‚Äúmiembros responsables‚Äù."
      },
      {
        type: "question",
        text: "Si una tarea ya fue terminada, ¬øqu√© deber√≠amos hacer en Planner?",
        options: [
          "Eliminarla para que no se vea",
          "Marcarla como completada para que quede el registro",
          "Cambiarle el t√≠tulo por la palabra LISTO",
          "Moverla al primer bucket aunque no est√© terminada"
        ],
        correctIndex: 1,
        explanation:
          "Lo ideal es marcar la tarea como completada, para que quede el registro hist√≥rico de que se realiz√≥."
      },
      {
        type: "question",
        text: "¬øPor qu√© es importante escribir buenas descripciones en las tareas de Planner?",
        options: [
          "Para que la tarjeta sea m√°s grande",
          "Para que solo el creador entienda la tarea",
          "Para que cualquier miembro del equipo entienda claramente qu√© hay que hacer",
          "No es importante, la descripci√≥n es opcional"
        ],
        correctIndex: 2,
        explanation:
          "Una buena descripci√≥n ayuda a que cualquier persona del equipo entienda el alcance, pasos y detalles de la tarea."
      },
      {
        type: "question",
        text: "Si Lexin quiere usar Planner para sus proyectos, ¬øqu√© beneficio obtiene?",
        options: [
          "Menos visibilidad del trabajo",
          "Mejor organizaci√≥n, seguimiento y claridad de qui√©n hace qu√© y para cu√°ndo",
          "M√°s correos y m√°s confusi√≥n",
          "Solo sirve para guardar archivos"
        ],
        correctIndex: 1,
        explanation:
          "Planner permite a Lexin organizar proyectos, ver responsables, fechas, avances y as√≠ reducir la confusi√≥n en el trabajo diario."
      },
      {
        type: "question",
        text: "¬øQu√© tipo de informaci√≥n es recomendable colocar en el t√≠tulo de una tarea?",
        options: [
          "Un chiste interno del equipo",
          "Un texto corto y claro que resuma la acci√≥n principal",
          "La fecha de nacimiento del responsable",
          "Solo un n√∫mero sin contexto"
        ],
        correctIndex: 1,
        explanation:
          "El t√≠tulo debe ser corto y claro, resumiendo la acci√≥n principal, por ejemplo: ‚ÄúDise√±ar plantilla de reporte de Lexin en Planner‚Äù."
      },
      {
        type: "question",
        text: "¬øQu√© representa la vista de ‚ÄúGr√°ficos‚Äù (Charts) en Planner?",
        options: [
          "Un chat del equipo",
          "Estad√≠sticas del plan: tareas completadas, en curso, retrasadas, etc.",
          "Una lista de correos enviados",
          "Un calendario externo"
        ],
        correctIndex: 1,
        explanation:
          "La vista de gr√°ficos muestra estad√≠sticas y visualizaciones de las tareas por estado, miembro, prioridad, etc."
      },
      {
        type: "question",
        text: "En Planner, ¬øqu√© permite la fecha de vencimiento de una tarea?",
        options: [
          "Enviar la tarea a otra organizaci√≥n",
          "Definir hasta cu√°ndo deber√≠a estar terminada y mejorar el seguimiento",
          "Bloquear la tarea autom√°ticamente",
          "Borrar la tarea al llegar la fecha"
        ],
        correctIndex: 1,
        explanation:
          "La fecha de vencimiento ayuda a fijar un l√≠mite de tiempo para completar la tarea y mejorar el seguimiento del plan."
      },
      {
        type: "question",
        text: "¬øC√≥mo se relaciona Planner con Teams?",
        options: [
          "No se pueden usar juntos",
          "Se puede agregar un plan de Planner como pesta√±a dentro de un canal de Teams",
          "Teams borra los planes de Planner",
          "Solo sirve para chats privados"
        ],
        correctIndex: 1,
        explanation:
          "Planner se integra con Teams, permitiendo agregar un plan como pesta√±a dentro de un canal para que el equipo lo use directamente."
      },
      {
        type: "question",
        text: "¬øPor qu√© Lexin quiere implementar Planner?",
        options: [
          "Porque est√° de moda tener muchas apps",
          "Para tener un espacio visual donde organizar tareas, proyectos y responsabilidades del equipo",
          "Para reemplazar todos los documentos",
          "Para no volver a reunirse nunca m√°s"
        ],
        correctIndex: 1,
        explanation:
          "Lexin busca en Planner un espacio visual y compartido para organizar tareas y proyectos, asignar responsables y hacer seguimiento."
      }
      // üëâ A partir de aqu√≠ puedes agregar m√°s preguntas hasta llegar a 100.
    ];

    const challenges = [
      {
        type: "challenge",
        text:
          "Reto: Explica en voz alta, en menos de 30 segundos, qu√© es Planner y para qu√© lo est√° usando Lexin.",
        guide:
          "Respuesta sugerida: Planner es una herramienta de Office 365 para organizar tareas y proyectos. Lexin la usa para visualizar el trabajo del equipo, asignar responsables y hacer seguimiento de sus actividades."
      },
      {
        type: "challenge",
        text:
          "Reto: Desde tu computador, entra a office.com e indica paso a paso c√≥mo encontrar la aplicaci√≥n Planner.",
        guide:
          "Gu√≠a sugerida: 1) Abre office.com. 2) Inicia sesi√≥n con tu cuenta institucional. 3) Haz clic en el lanzador de aplicaciones. 4) Busca y selecciona 'Planner'."
      },
      {
        type: "challenge",
        text:
          "Reto: Piensa en un proyecto real del equipo Lexin y di en voz alta c√≥mo lo organizar√≠as en buckets dentro de Planner.",
        guide:
          "Ejemplo: Crear buckets como 'Ideas', 'En planeaci√≥n', 'En ejecuci√≥n' y 'Finalizado' para visualizar el avance del proyecto."
      },
      {
        type: "challenge",
        text:
          "Reto: Menciona en voz alta al menos tres datos que puedes configurar dentro de una tarea de Planner.",
        guide:
          "Respuesta sugerida: t√≠tulo, descripci√≥n, fecha de vencimiento, asignados, checklist, etiquetas, adjuntos y comentarios."
      },
      {
        type: "challenge",
        text:
          "Reto: Di en voz alta por qu√© usar Planner puede reducir la cantidad de correos internos en el equipo Lexin.",
        guide:
          "Explicaci√≥n: Planner centraliza las tareas y comentarios en un mismo lugar, en lugar de dispersar la informaci√≥n en muchos correos."
      },
      {
        type: "challenge",
        text:
          "Reto: Imagina que debes ense√±ar Planner a un nuevo miembro de Lexin. Resume en 30 segundos c√≥mo le explicar√≠as el plan principal del equipo.",
        guide:
          "Ejemplo: 'Este es nuestro plan en Planner: vemos buckets con las fases del trabajo, tareas con responsables y fechas, y usamos colores para los tipos de actividad'."
      }
      // üëâ Agrega m√°s retos similares hasta llegar a 50.
    ];

    // ===============================
    // Estado del juego
    // ===============================
    const baseTimes = {
      question: 20,  // preguntas: 20s
      challenge: 30, // retos: 30s
      phone: 30
    };

    const maxPerRound = 3;
    let currentItem = null;
    let currentType = null;
    let roundCount = 0;
    let successCount = 0;
    let timerId = null;
    let timeLeft = 0;
    let currentTimeoutCallback = null;

    let pendingWasSuccess = false;
    let feedbackTimerId = null;
    let feedbackSeconds = 5;

    let lifelines = {
      skip: true,
      phone: true,
      fifty: true
    };

    let lastCountdownShown = null;

    // ===============================
    // Elementos DOM
    // ===============================
    const appRoot = document.getElementById("appRoot");
    const countdownOverlay = document.getElementById("countdownOverlay");

    const startScreen = document.getElementById("startScreen");
    const gameScreen = document.getElementById("gameScreen");
    const resultScreen = document.getElementById("resultScreen");
    const itemArea = document.getElementById("itemArea");
    const feedbackArea = document.getElementById("feedbackArea");

    const startButton = document.getElementById("startButton");
    const progressText = document.getElementById("progressText");
    const timerText = document.getElementById("timerText");
    const typeLabel = document.getElementById("typeLabel");
    const questionNumberText = document.getElementById("questionNumberText");
    const streakText = document.getElementById("streakText");
    const questionText = document.getElementById("questionText");
    const optionsContainer = document.getElementById("optionsContainer");
    const challengeActions = document.getElementById("challengeActions");
    const challengeDoneBtn = document.getElementById("challengeDoneBtn");

    const feedbackTitle = document.getElementById("feedbackTitle");
    const feedbackBody = document.getElementById("feedbackBody");
    const nextItemBtn = document.getElementById("nextItemBtn");

    const resultText = document.getElementById("resultText");
    const resultSubtitle = document.getElementById("resultSubtitle");
    const retryBtn = document.getElementById("retryBtn");
    const backHomeBtn = document.getElementById("backHomeBtn");

    const skipBtn = document.getElementById("skipBtn");
    const phoneBtn = document.getElementById("phoneBtn");
    const fiftyBtn = document.getElementById("fiftyBtn");

    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");

    // ===============================
    // Tema claro / oscuro
    // ===============================
    let currentTheme = "dark";
    function updateThemeVisuals() {
      if (currentTheme === "dark") {
        document.body.classList.remove("light-theme");
        themeIcon.textContent = "üåô";
        themeLabel.textContent = "Oscuro";
      } else {
        document.body.classList.add("light-theme");
        themeIcon.textContent = "‚òÄÔ∏è";
        themeLabel.textContent = "Claro";
      }
    }

    themeToggleBtn.addEventListener("click", () => {
      currentTheme = currentTheme === "dark" ? "light" : "dark";
      updateThemeVisuals();
    });

    updateThemeVisuals();

    // ===============================
    // Navegaci√≥n
    // ===============================
    function showStartScreen() {
      stopTimer();
      stopFeedbackTimer();
      roundCount = 0;
      successCount = 0;
      updateProgress();
      timerText.textContent = "00s";
      timerText.classList.remove("timer-warning");
      appRoot.classList.remove("app-win", "app-lose");

      startScreen.classList.remove("hidden");
      gameScreen.classList.add("hidden");
      resultScreen.classList.add("hidden");
    }

    function showGameScreen() {
      startScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      resultScreen.classList.add("hidden");
      itemArea.classList.remove("hidden");
      feedbackArea.classList.add("hidden");
    }

    function showResultScreen(won) {
      stopTimer();
      stopFeedbackTimer();
      startScreen.classList.add("hidden");
      gameScreen.classList.add("hidden");
      resultScreen.classList.remove("hidden");

      if (won) {
        appRoot.classList.add("app-win");
        appRoot.classList.remove("app-lose");
        resultText.innerHTML = "<span class='win-bounce'>¬°GANASTE!</span>";
        resultSubtitle.textContent =
          "Completaste 3 participaciones exitosas. Lexin se est√° volviendo pro en Planner.";
        playWinSound();
      } else {
        appRoot.classList.add("app-lose");
        appRoot.classList.remove("app-win");
        resultText.textContent = "Est√°s casi a ser un pro en Planner";
        resultSubtitle.textContent =
          "Sigue practicando. Cada intento con esta Loter√≠a Planner te ayuda a dominar la herramienta.";
        playLoseSound();
      }
    }

    function updateProgress() {
      progressText.textContent = `${roundCount} / ${maxPerRound}`;
      streakText.textContent = `Racha: ${successCount} ‚úÖ`;
    }

    // ===============================
    // Juego
    // ===============================
    function randomFromArray(arr) {
      const i = Math.floor(Math.random() * arr.length);
      return arr[i];
    }

    function pickRandomItem(type) {
      if (type === "question") return randomFromArray(questions);
      if (type === "challenge") return randomFromArray(challenges);

      const chooseQuestion = Math.random() < 0.5;
      if (chooseQuestion && questions.length > 0) {
        return randomFromArray(questions);
      } else if (!chooseQuestion && challenges.length > 0) {
        return randomFromArray(challenges);
      } else if (questions.length > 0) {
        return randomFromArray(questions);
      } else {
        return randomFromArray(challenges);
      }
    }

    function resetLifelines() {
      lifelines = { skip: true, phone: true, fifty: true };
      updateLifelineButtons();
    }

    function updateLifelineButtons() {
      skipBtn.disabled = !lifelines.skip;
      phoneBtn.disabled = !lifelines.phone;
      fiftyBtn.disabled = !lifelines.fifty || currentType !== "question";
      fiftyBtn.style.opacity = currentType === "question" ? "1" : "0.25";
    }

    function startGame() {
      roundCount = 0;
      successCount = 0;
      updateProgress();
      appRoot.classList.remove("app-win", "app-lose");
      resetLifelines();
      loadNewItem();
    }

    function loadNewItem(forceType = null) {
      stopTimer();
      stopFeedbackTimer();
      currentItem = pickRandomItem(forceType);
      currentType = currentItem.type;
      pendingWasSuccess = false;
      lastCountdownShown = null;
      renderCurrentItem();
    }

    function renderCurrentItem() {
      showGameScreen();
      clearOptions();
      itemArea.classList.remove("hidden");
      feedbackArea.classList.add("hidden");

      questionNumberText.textContent = `Participaci√≥n ${roundCount + 1} de ${maxPerRound}`;
      typeLabel.textContent = currentType === "question" ? "Pregunta" : "Reto";

      questionText.textContent = currentItem.text;
      updateLifelineButtons();

      if (currentType === "question") {
        optionsContainer.classList.remove("hidden");
        challengeDoneBtn.classList.add("hidden");

        currentItem.options.forEach((opt, index) => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.innerHTML = `<span><span class="index">${String.fromCharCode(
            65 + index
          )}.</span> ${opt}</span>`;
          btn.addEventListener("click", () => handleAnswer(index));
          optionsContainer.appendChild(btn);
        });

        startTimer(baseTimes.question, () => {
          pendingWasSuccess = false;
          showFeedback(false, true);
        });
      } else {
        optionsContainer.classList.add("hidden");
        challengeDoneBtn.classList.remove("hidden");

        challengeDoneBtn.onclick = () => {
          pendingWasSuccess = true;
          showFeedback(true, false);
        };

        startTimer(baseTimes.challenge, () => {
          pendingWasSuccess = false;
          showFeedback(false, true);
        });
      }
    }

    function clearOptions() {
      optionsContainer.innerHTML = "";
    }

    function handleAnswer(selectedIndex) {
      if (!currentItem || currentType !== "question") return;

      const correctIndex = currentItem.correctIndex;
      const buttons = Array.from(
        optionsContainer.querySelectorAll(".option-btn")
      );

      buttons.forEach((btn, i) => {
        if (i === correctIndex) btn.classList.add("correct");
        if (i === selectedIndex && selectedIndex !== correctIndex) {
          btn.classList.add("wrong");
        }
        btn.disabled = true;
      });

      stopTimer();

      if (selectedIndex === correctIndex) {
        pendingWasSuccess = true;
        showFeedback(true, false);
      } else {
        pendingWasSuccess = false;
        showFeedback(false, false);
      }
    }

    function showFeedback(isSuccess, byTimeout) {
      stopTimer();
      itemArea.classList.add("hidden");
      feedbackArea.classList.remove("hidden");

      let title = "";
      let body = "";

      if (currentType === "question") {
        const correctText = currentItem.options[currentItem.correctIndex];

        if (isSuccess) {
          title = "‚úÖ ¬°Respuesta correcta!";
          body =
            "La respuesta correcta es: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        } else if (byTimeout) {
          title = "‚è±Ô∏è Tiempo agotado";
          body =
            "Se acab√≥ el tiempo. La respuesta correcta era: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        } else {
          title = "‚ùå Respuesta incorrecta";
          body =
            "La respuesta correcta es: <strong>" +
            correctText +
            "</strong>. " +
            (currentItem.explanation || "");
        }
      } else {
        if (isSuccess) {
          title = "üí™ ¬°Reto completado!";
          body =
            (currentItem.guide
              ? "Esta es una forma sugerida de hacerlo: "
              : "") + (currentItem.guide || "");
        } else if (byTimeout) {
          title = "‚è±Ô∏è Reto no completado a tiempo";
          body =
            "No pasa nada, aqu√≠ tienes una gu√≠a para hacerlo la pr√≥xima vez: " +
            (currentItem.guide || "");
        } else {
          title = "Reto no completado";
          body =
            "Aqu√≠ tienes una gu√≠a para la pr√≥xima vez: " +
            (currentItem.guide || "");
        }
      }

      feedbackTitle.innerHTML = title;
      feedbackBody.innerHTML = body;

      nextItemBtn.disabled = true;
      feedbackSeconds = 5;
      nextItemBtn.textContent = `Siguiente (${feedbackSeconds})`;
      startFeedbackTimer();
    }

    function applyFeedbackAndContinue() {
      roundCount++;
      if (pendingWasSuccess) successCount++;
      updateProgress();

      if (roundCount >= maxPerRound) {
        const won = successCount >= maxPerRound;
        showResultScreen(won);
      } else {
        loadNewItem();
      }
    }

    // ===============================
    // Timer principal
    // ===============================
    function showCountdownNumber(n) {
      if (lastCountdownShown === n) return;
      lastCountdownShown = n;
      countdownOverlay.textContent = n;
      countdownOverlay.classList.remove("show");
      void countdownOverlay.offsetWidth; // reinicia animaci√≥n
      countdownOverlay.classList.add("show");
    }

    function startTimer(seconds, onTimeOut) {
      stopTimer();
      timeLeft = seconds;
      currentTimeoutCallback = onTimeOut;
      timerText.textContent = timeLeft + "s";
      timerText.classList.remove("timer-warning");
      lastCountdownShown = null;

      timerId = setInterval(() => {
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        timerText.textContent = timeLeft + "s";

        const threshold = currentType === "question" ? 5 : 7;

        if (timeLeft > 0 && timeLeft <= threshold) {
          timerText.classList.add("timer-warning");
          playBeep(900, 110, 0.22);
          showCountdownNumber(timeLeft);
        }

        if (timeLeft <= 0) {
          stopTimer();
          timerText.classList.remove("timer-warning");
          if (typeof currentTimeoutCallback === "function") {
            currentTimeoutCallback();
          }
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    // ===============================
    // Timer de feedback (5 s)
    // ===============================
    function startFeedbackTimer() {
      stopFeedbackTimer();
      feedbackTimerId = setInterval(() => {
        feedbackSeconds--;
        if (feedbackSeconds <= 0) {
          feedbackSeconds = 0;
          stopFeedbackTimer();
          nextItemBtn.disabled = false;
          nextItemBtn.textContent = "Siguiente";
        } else {
          nextItemBtn.textContent = `Siguiente (${feedbackSeconds})`;
        }
      }, 1000);
    }

    function stopFeedbackTimer() {
      if (feedbackTimerId) {
        clearInterval(feedbackTimerId);
        feedbackTimerId = null;
      }
    }

    // ===============================
    // Comodines
    // ===============================
    skipBtn.addEventListener("click", () => {
      if (!lifelines.skip) return;
      lifelines.skip = false;
      updateLifelineButtons();
      loadNewItem(currentType); // mantiene tipo
    });

    phoneBtn.addEventListener("click", () => {
      if (!lifelines.phone || !currentTimeoutCallback) return;
      lifelines.phone = false;
      updateLifelineButtons();
      startTimer(baseTimes.phone, currentTimeoutCallback);
    });

    fiftyBtn.addEventListener("click", () => {
      if (!lifelines.fifty || currentType !== "question") return;
      lifelines.fifty = false;
      updateLifelineButtons();

      const buttons = Array.from(
        optionsContainer.querySelectorAll(".option-btn")
      );
      const correctIndex = currentItem.correctIndex;
      const incorrect = buttons
        .map((btn, idx) => ({ btn, idx }))
        .filter(obj => obj.idx !== correctIndex);

      shuffleArray(incorrect);
      const toRemove = incorrect.slice(0, 2);
      toRemove.forEach(obj => {
        obj.btn.classList.add("eliminated");
        obj.btn.disabled = true;
      });
    });

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // ===============================
    // Eventos generales
    // ===============================
    startButton.addEventListener("click", () => {
      startGame();
    });

    retryBtn.addEventListener("click", () => {
      startGame();
    });

    backHomeBtn.addEventListener("click", () => {
      showStartScreen();
    });

    nextItemBtn.addEventListener("click", () => {
      if (!nextItemBtn.disabled) {
        applyFeedbackAndContinue();
      }
    });

    // Pantalla inicial
    showStartScreen();
  </script>
</body>
</html>
